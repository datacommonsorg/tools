(this["webpackJsonpmcf-browser"]=this["webpackJsonpmcf-browser"]||[]).push([[0],{12:function(e,t,n){e.exports=n(18)},18:function(e,t,n){"use strict";n.r(t);n(8);var r=n(0),a=n.n(r),s=n(10),i=n.n(s),c=n(3),l=n(4),o=n(7),u=n(6),d=n(1),h=n.n(d),f=n(5),p=n(2),m="https://api.datacommons.org",v="error in declaring node",b="invalid namespace in node declaration",E="current node must be set before setting dcid",y="a node can only have one dcid",N="dcid property must be a string, not a node reference",g="cannot set dcid for current node; check if dcid is already set",k="current node must be set before declaring properties",w="missing ':', incorrect mcf triple format",j="missing property label",O="missing property value";function x(e){return C.apply(this,arguments)}function C(){return(C=Object(p.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=m+"/node/property-labels?dcids="+t,e.abrupt("return",fetch(n).then((function(e){return e.json()})).then((function(e){return JSON.parse(e.payload)[t]})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t,n){return L.apply(this,arguments)}function L(){return(L=Object(p.a)(h.a.mark((function e(t,n,r){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=m+"/node/property-values?limit=500&dcids="+t+"&property="+n+"&direction="+(r?"in":"out"),e.abrupt("return",fetch(a).then((function(e){return e.json()})).then((function(e){return JSON.parse(e.payload)[t]})).then((function(e){return r?e.in:e.out})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){if(!("dcid"in e)&&!("value"in e))throw new Error('ERROR: DC API returned an object with no "dcid" or "value" field: '+e);if("dcid"in e){var t=A.getNode("dcid:"+e.dcid);return t.setDCID(e.dcid),t.existsInKG=!0,t}return e.value}function D(e){return S.apply(this,arguments)}function S(){return(S=Object(p.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=m+"/node/triples?dcids="+t+"&limit=1",e.abrupt("return",fetch(n).then((function(e){return e.json()})).then((function(e){return!!JSON.parse(e.payload)[t]})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){return!e.startsWith("//")&&0!==e.length&&!e.startsWith("#")}var A=function(){function e(t){Object(c.a)(this,e),this.localId=t.startsWith("l:")?t:null,this.dcid=null,this.alreadyFetched=!1,this.existsInKG=!1,this.assertions=[],this.invAssertions=[],e.nodeHash[t]=this}return Object(l.a)(e,[{key:"setDCID",value:function(t){if(this.dcid&&this.dcid!==t)return!1;var n=e.nodeHash["dcid:"+t];return n&&n!==this&&this.mergeNode(n),this.dcid=t,e.nodeHash["dcid:"+t]=this,!0}},{key:"mergeNode",value:function(e){var t=this;this.localId!==e.localId&&(e.assertions.forEach((function(e){e.src=t,t.assertions.push(e)})),e.invAssertions.forEach((function(e){e.target=t,t.invAssertions.push(e)})))}},{key:"setExistsInKG",value:function(){var e=Object(p.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.dcid&&!this.existsInKG){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,D(this.dcid);case 4:this.existsInKG=e.sent;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createAssertionsFromLabels",value:function(){var t=Object(p.a)(h.a.mark((function t(n,r){var a,s,i,c=this;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=Object(f.a)(n),t.prev=1,i=h.a.mark((function t(){var n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=s.value,t.next=3,I(c.dcid,n,r).then((function(t){if(!t)throw new Error("No property values for dcid: "+c.dcid+" label: "+n);t.forEach((function(t){var a=F(t);if(r&&!e.isNode(a))throw new Error("Error creating assertion with non Node source");var s=r?a:c,i=r?c:a;e.isNode(a)&&a.alreadyFetched||new P(s,n,i,t.provenanceId)}))}));case 3:case"end":return t.stop()}}),t)})),a.s();case 4:if((s=a.n()).done){t.next=8;break}return t.delegateYield(i(),"t0",6);case 6:t.next=4;break;case 8:t.next=13;break;case 10:t.prev=10,t.t1=t.catch(1),a.e(t.t1);case 13:return t.prev=13,a.f(),t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[1,10,13,16]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"fetchRemoteData",value:function(){var e=Object(p.a)(h.a.mark((function e(){var t=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.alreadyFetched&&this.dcid){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,x(this.dcid).then(function(){var e=Object(p.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createAssertionsFromLabels(n.outLabels,!1);case 2:return e.next=4,t.createAssertionsFromLabels(n.inLabels,!0);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:this.alreadyFetched=!0;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRef",value:function(){var e=this.dcid?this.dcid:"",t="";return this.localId&&!this.localId.includes("dcid")&&(t="["+this.localId+"]"),[e,t].join(" ").trim()}}],[{key:"getNode",value:function(t){var n=e.nodeHash[t];return n||new e(t)}},{key:"isNode",value:function(t){return t instanceof e}}]),e}();A.nodeHash={};var P=function e(t,n,r,a){Object(c.a)(this,e),this.src=t,this.property=n,this.provenance=a,this.target=r,t.assertions.push(this),r instanceof Object&&r.invAssertions.push(this)},H={l:"l",schema:"dcid",dcs:"dcid",dcid:"dcid"},M=function(){function e(t){Object(c.a)(this,e),this.prov=t,this.curNode=null,this.lineNum=-1,this.errors=[]}return Object(l.a)(e,[{key:"parsePropValues",value:function(e){var t,n=[],r=Object(f.a)(e.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/));try{for(r.s();!(t=r.n()).done;){var a=t.value,s=a.split(":")[0].trim();if(s in H)n.push({ns:s,ref:a.substring(a.indexOf(":")+1).trim()});else{if(a.split(":").length>1&&!s.startsWith('"'))return this.errors.push([this.lineNum,this.line,"unrecognized namespace"]),[];n.push(a.replace(/^[" ]*(.*?)[" ]*$/g,"$1"))}}}catch(i){r.e(i)}finally{r.f()}return n}},{key:"setCurNode",value:function(t){if(1===t.length){var n,r;if(t[0]instanceof Object){if("dcid"!==(r=t[0].ns))return void this.errors.push([this.lineNum,this.line,b]);r+=":",n=t[0].ref}else n=t[0],r="";var a="l:"+r+n;if(this.curNode=A.getNode(a),"dcid:"===r){if(!this.curNode.setDCID(n))return void this.errors.push([this.lineNum,this.line,g]);e.localNodeHash[r+n]=this.curNode}else e.localNodeHash[a]=this.curNode}else this.errors.push([this.lineNum,this.line,v])}},{key:"setCurNodeDCID",value:function(e){this.curNode?1===e.length?"string"===typeof e[0]?this.curNode.setDCID(e[0])||this.errors.push([this.lineNum,this.line,g]):this.errors.push([this.lineNum,this.line,N]):this.errors.push([this.lineNum,this.line,y]):this.errors.push([this.lineNum,this.line,E])}},{key:"createAssertionsFromParsedValues",value:function(e,t){if(this.curNode){var n,r=Object(f.a)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value,s=a;a instanceof Object&&(s=A.getNode(H[a.ns]+":"+a.ref),"dcid"===H[a.ns]&&(s.setDCID(a.ref)||this.errors.push([this.lineNum,this.line,g]))),new P(this.curNode,e,s,this.prov)}}catch(i){r.e(i)}finally{r.f()}}else this.errors.push([this.lineNum,this.line,k])}},{key:"parseLine",value:function(e){if(R(e=e.trim()))if(e.includes(":")){var t=e.split(":",1)[0].trim(),n=e.substring(e.indexOf(":")+1).trim();if(t)if(n){var r=this.parsePropValues(n);switch(t){case"Node":this.setCurNode(r);break;case"dcid":this.setCurNodeDCID(r);break;default:this.createAssertionsFromParsedValues(t,r)}}else this.errors.push([this.lineNum,this.line,O]);else this.errors.push([this.lineNum,this.line,j])}else this.errors.push([this.lineNum,this.line,w])}},{key:"parseMcfStr",value:function(t){var n=this,r=t.split("\n");return this.lineNum=1,r.forEach((function(e){n.line=e,n.parseLine(e),n.lineNum++})),{localNodes:Object.keys(e.localNodeHash),errMsgs:this.errors}}}],[{key:"readFile",value:function(t){var n=new FileReader;return n.readAsText(t),new Promise((function(r,a){n.addEventListener("loadend",(function(a){var s=new e(t.name);r(s.parseMcfStr(n.result))})),n.addEventListener("error",a)}))}}]),e}();M.localNodeHash={};var T=n(11);function G(e){return e.includes("->")?e.split("->")[1]:null}function K(e){var t=e.match("E:(.*)->(.*)");return t?t[0]:null}var W=function(){function e(){Object(c.a)(this,e),this.csvIndex=-1}return Object(l.a)(e,[{key:"getLocalIdFromEntityId",value:function(e){return e?e.replace("->","_").replace("E:","")+"_R"+this.csvIndex:null}},{key:"fillPropertyValues",value:function(e,t){var n,r=[],a=Object(f.a)(e.split(","));try{for(a.s();!(n=a.n()).done;){var s=n.value,i=void 0,c=K(s),l=G(s);if(c){var o="l:"+this.getLocalIdFromEntityId(c);i=s.replace(c,o)}else i=l?s.replace(/C:(.*)->(.*)/,t[l]):s;r.push(i)}}catch(u){a.e(u)}finally{a.f()}return r.join(",")}},{key:"fillTemplateFromRow",value:function(e,t){var n,r=[],a=Object(f.a)(e.split("\n"));try{for(a.s();!(n=a.n()).done;){var s=n.value;if(s.trim()&&R(s)){var i=s.split(":")[0].trim(),c=s.substring(s.indexOf(":")+1).trim();if("Node"===i){if(c.includes(","))throw new Error("cannot have multiple ids for Node declaration");var l=K(c);l?r.push(i+": "+this.getLocalIdFromEntityId(l)):r.push(i+": "+c)}else{var o=this.fillPropertyValues(c,t);r.push(i+": "+o)}}else r.push("")}}catch(u){a.e(u)}finally{a.f()}return r.join("\n")}},{key:"csvToMcf",value:function(e,t){this.csvIndex=1;var n,r=[],a=Object(f.a)(t);try{for(a.s();!(n=a.n()).done;){var s=n.value;r.push(this.fillTemplateFromRow(e,s)),this.csvIndex+=1}}catch(i){a.e(i)}finally{a.f()}return r.join("\n")}},{key:"readCsvFile",value:function(){var e=Object(p.a)(h.a.mark((function e(t,n){var r,a=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FileReader).readAsText(n),e.abrupt("return",new Promise((function(e,n){r.addEventListener("loadend",(function(n){T().fromString(r.result).then((function(n){e(a.csvToMcf(t,n))}))})),r.addEventListener("error",n)})));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}],[{key:"readTmcfFile",value:function(){var e=Object(p.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FileReader).readAsText(t),e.abrupt("return",new Promise((function(e,t){n.addEventListener("loadend",(function(t){e(n.result)})),n.addEventListener("error",t)})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"generateMcf",value:function(){var t=Object(p.a)(h.a.mark((function t(n,r){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.readTmcfFile(n).then((function(t){return(new e).readCsvFile(t,r)})));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),e}();function U(){return(U=Object(p.a)(h.a.mark((function e(t){var n,r,a,s,i,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=Object(f.a)(t);try{for(s.s();!(i=s.n()).done;)(c=i.value).name.endsWith(".tmcf")?n=c:c.name.endsWith(".csv")?r=c:a=c}catch(l){s.e(l)}finally{s.f()}if(!a){e.next=4;break}return e.abrupt("return",M.readFile(a));case 4:if(!n||!r){e.next=6;break}return e.abrupt("return",W.generateMcf(n,r).then((function(e){return console.log(e),new M(n.name+"&"+r.name).parseMcfStr(e)})));case 6:return e.abrupt("return",{errMsgs:[],localNodes:[]});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t){var n=A.getNode(e);return t&&n.setDCID(e.replace("dcid:","")),n}function J(e){return A.isNode(e)}function $(e){return q.apply(this,arguments)}function q(){return(q=Object(p.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(!t.existsInKG){e.next=4;break}return e.abrupt("return","blue");case 4:return e.abrupt("return",t.setExistsInKG().then((function(){return t.existsInKG?"blue":!t.dcid&&t.localId&&t.localId in M.localNodeHash?"purple":t.dcid||t.localId in M.localNodeHash?"red":"orange"})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _="#";function z(e){e.includes(":")?window.location.hash=_+"&id="+e:window.location.hash=_+"&id=dcid:"+e}function B(e){_="#";var t,n=Object(f.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;_+="&file="+r}}catch(a){n.e(a)}finally{n.f()}}function X(e){e.startsWith("https")&&window.open(e)}var Y=function(e){return e.loading?a.a.createElement("div",{className:"centered col"},a.a.createElement("br",null),a.a.createElement("div",{className:"loadingSpinner"}),a.a.createElement("h2",null,e.msg)):null},Q=function(e){return e.inverse?a.a.createElement("tr",null,a.a.createElement("th",null,"Property"),a.a.createElement("th",null,"Source"),a.a.createElement("th",null,"Provenance")):a.a.createElement("tr",null,a.a.createElement("th",null,"Property"),a.a.createElement("th",null,"Target"),a.a.createElement("th",null,"Provenance"))};function Z(e){return ee.apply(this,arguments)}function ee(){return(ee=Object(p.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!J(t)){e.next=5;break}return e.next=3,$(t);case 3:return n=e.sent,e.abrupt("return",a.a.createElement("p",{className:"clickable",id:n,onClick:function(){return z(t.localId||t.dcid)}},t.getRef()));case 5:return e.abrupt("return",a.a.createElement("p",null,t));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){if(e.startsWith("dc/"))return a.a.createElement("p",{id:"black",className:"clickable",onClick:function(){return z(e)}},e);if(!e.startsWith("https"))return a.a.createElement("p",null,e.replace("&",", "));if(!e.includes("&"))return a.a.createElement("p",{className:"clickable",onClick:function(){return X(e)}},e.split("/").pop());var t,n=[],r=[],s=Object(f.a)(e.split("&"));try{for(s.s();!(t=s.n()).done;){var i=t.value;n.push(i),r.push(i.split("/").pop())}}catch(c){s.e(c)}finally{s.f()}return a.a.createElement("div",null,a.a.createElement("p",{className:"clickable",onClick:function(){return X(n[0])}},r[0]),a.a.createElement("p",null,",","\xa0"),a.a.createElement("p",{className:"clickable",onClick:function(){return X(n[1])}},r[1]))}var ne=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).state={tableRows:null,loading:!0},r}return Object(l.a)(n,[{key:"componentDidUpdate",value:function(e){var t=this;e.triples!==this.props.triples&&(this.setState({loading:!0}),this.getTripleRows().then((function(e){t.setState({tableRows:e,loading:!1})})))}},{key:"getTripleRows",value:function(){var e=Object(p.a)(h.a.mark((function e(){var t,n,r,s,i,c,l,o,u;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=0,r=Object(f.a)(this.props.triples),e.prev=3,r.s();case 5:if((s=r.n()).done){e.next=18;break}return i=s.value,c=this.props.inverse?i.src:i.target,e.next=10,Z(c);case 10:l=e.sent,o=te(i.provenance),u=void 0,i.provenance.startsWith("dc/")||(u="bold"),t.push(a.a.createElement("tr",{className:u,key:n},a.a.createElement("td",null,i.property),a.a.createElement("td",null,l),a.a.createElement("td",null,o))),n+=1;case 16:e.next=5;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),r.e(e.t0);case 23:return e.prev=23,r.f(),e.finish(23);case 26:return e.abrupt("return",t);case 27:case"end":return e.stop()}}),e,this,[[3,20,23,26]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.loading?null:a.a.createElement("table",null,a.a.createElement("thead",null,a.a.createElement(Q,{inverse:this.props.inverse})),a.a.createElement("tbody",null,this.state.tableRows))}}]),n}(r.Component),re=function(){return a.a.createElement("div",null,a.a.createElement("p",{className:"inline"}," | "),a.a.createElement("p",{className:"inline",id:"blue"},"Node has dcid that exists in DC KG"),a.a.createElement("p",{className:"inline"}," | "),a.a.createElement("p",{className:"inline",id:"purple"},"Node has resolved local reference and no dcid"),a.a.createElement("p",{className:"inline"}," | "),a.a.createElement("p",{className:"inline",id:"orange"},"Node has unresolved local reference and no dcid"),a.a.createElement("p",{className:"inline"}," | "),a.a.createElement("p",{className:"inline",id:"red"},"Default; Node has dcid which does not exist in DC KG"),a.a.createElement("p",{className:"inline"}," | "))},ae=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).state={ref:null,asserts:[],invAsserts:[],fetching:!0},r}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.setNodeData()}},{key:"componentDidUpdate",value:function(e){e.node!==this.props.node&&this.setNodeData()}},{key:"setNodeData",value:function(){var e=this;console.log(this.props.node);var t=this.props.node;this.setState({ref:t.getRef(),fetching:!0,asserts:[],invAsserts:[]}),$(t).then((function(t){return e.setState({elemId:t})})),t.fetchRemoteData().then((function(){e.setState({asserts:t.assertions,invAsserts:t.invAssertions,fetching:!1})}))}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement(re,null),a.a.createElement("br",null),a.a.createElement("h1",{className:"inline"},"Currently Viewing: "),a.a.createElement("h1",{className:"inline",id:this.state.elemId},this.state.ref),a.a.createElement("br",null),a.a.createElement(Y,{loading:this.state.fetching,msg:"...fetching triples..."}),a.a.createElement("br",null),a.a.createElement("h3",{className:"inline padded"},"Node Properties"),a.a.createElement("p",{className:"inline"}," - current node is source"),a.a.createElement("br",null),a.a.createElement(ne,{triples:this.state.asserts,inverse:!1}),a.a.createElement("br",null),a.a.createElement("h3",{className:"inline padded"},"Incoming Properties from Other Nodes"),a.a.createElement("p",{className:"inline"}," - current node is target"),a.a.createElement("br",null),a.a.createElement(ne,{triples:this.state.invAsserts,inverse:!0}))}}]),n}(r.Component),se=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"handleSearch",value:function(e){var t;13===e.keyCode&&((t=e.target.value).includes(":")?window.location.hash=_+"&search="+t:window.location.hash=_+"&search=dcid:"+t)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"Header"},a.a.createElement("div",null,a.a.createElement("button",{onClick:function(){window.location.hash=_}},"Return Home"),a.a.createElement("input",{type:"file",title:"Upload one MCF file or one set of TMCF+CSV files\nto preview in Data Commons. Alternatively, specify a path\nto the file in the url, ex: /build/#&file=<path to tmcf>&file=<path to csv>",onChange:function(t){e.props.upload(Array.from(t.target.files))},accept:".mcf,.tmcf,.csv",required:!0,multiple:!0})),a.a.createElement("input",{type:"search",list:"subjIds",onKeyUp:this.handleSearch,placeholder:"Search by id; default namespace is 'dcid:'"}),a.a.createElement("datalist",{id:"subjIds"},this.props.subjIds.map((function(e){return a.a.createElement("option",{value:e,key:e})}))))}}]),n}(r.Component),ie=function(e){return e.errsList.length?a.a.createElement("div",null,a.a.createElement("h3",{className:"underline"},"Parsing Errors"),a.a.createElement("table",null,a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"Line Num"),a.a.createElement("th",null,"Line"),a.a.createElement("th",null,"Error Message"))),a.a.createElement("tbody",null,e.errsList.map((function(e){return a.a.createElement("tr",{key:e[0]},a.a.createElement("td",null,e[0]),a.a.createElement("td",null,e[1]),a.a.createElement("td",null,e[2]))}))))):null},ce=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"centered col"},a.a.createElement("h3",null,"Current Files:"),a.a.createElement("ul",null,this.props.fileList.map((function(e){return a.a.createElement("li",{className:"clickable",key:e.name,onClick:function(){return X(e.name)}},e.name)}))),a.a.createElement("br",null),a.a.createElement("button",{onClick:this.props.clear},"Clear"),a.a.createElement("br",null),a.a.createElement(ie,{errsList:this.props.errs}),a.a.createElement("h3",null,"Subject Nodes:"),a.a.createElement(Y,{loading:this.props.loading,msg:"...loading mcf..."}),a.a.createElement("ul",null,this.props.subjNodes.map((function(e){return a.a.createElement("li",{className:"clickable",key:e,onClick:function(){return z(e)}},e)}))))}}]),n}(r.Component),le=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).state={subjNodes:[],curNode:null,fileList:[],loading:!1,firstLoad:!0,parsingErrs:[]},r}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("hashchange",(function(){return e.handleHashChange()}),!1),this.state.firstLoad&&(this.parseUrl(),this.setState({firstLoad:!1}))}},{key:"parseUrl",value:function(){var e=new URLSearchParams(window.location.hash.split("#")[1]),t=e.getAll("file");if(t.length)this.loadRemoteFiles(0,t),B(t);else{var n=e.get("search");if(n){var r=V(n,!0);this.setState({curNode:r})}}}},{key:"handleHashChange",value:function(){var e=null,t=new URLSearchParams(window.location.hash.split("#")[1]),n=t.get("id");n?e=V(n,!1):(n=t.get("search"))&&(e=V(n,!0)),this.setState({curNode:e})}},{key:"loadRemoteFiles",value:function(e,t){var n=this;if(e>=t.length)this.submitFileList();else{var r=new XMLHttpRequest;r.responseType="blob",r.open("GET",t[e]),r.onload=function(){r.response.name=t[e],n.setState({fileList:n.state.fileList.concat(r.response)},(function(){return n.loadRemoteFiles(e+1,t)}))},r.send()}}},{key:"submitFileList",value:function(){var e=this;this.setState({loading:!0}),function(e){return U.apply(this,arguments)}(this.state.fileList).then((function(t){e.setState({parsingErrs:t.errMsgs,subjNodes:t.localNodes,loading:!1},(function(){return e.handleHashChange()}))}))}},{key:"onClearPress",value:function(){this.setState({subjNodes:[],fileList:[],loading:!1,parsingErrs:[]}),A.nodeHash={},M.localNodeHash={},B(""),window.location.hash=""}},{key:"uploadFiles",value:function(e){var t=this;this.setState({curNode:null,fileList:this.state.fileList.concat(e)},(function(){return t.submitFileList()}))}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement(se,{upload:function(t){return e.uploadFiles(t)},subjIds:this.state.subjNodes}),this.state.curNode?a.a.createElement(ae,{node:this.state.curNode}):a.a.createElement(ce,{fileList:this.state.fileList,clear:function(){return e.onClearPress()},errs:this.state.parsingErrs,loading:this.state.loading,subjNodes:this.state.subjNodes}))}}]),n}(r.Component);i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(le,null)),document.getElementById("root"))},8:function(e,t,n){}},[[12,1,2]]]);
//# sourceMappingURL=main.5db0e3c7.chunk.js.map